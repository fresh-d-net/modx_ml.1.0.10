Мультиязычная версия ModxEolution 1.0.10
==============

# Инициализация

## Точки входа
Существует три точки входа в приложение modx:
* /index.php - frontend
* /index-ajax.php - ajax-шлюз. Переработан под запуск сниппетов. Принимает два параметра:

?snippet=snip_name&data[var_name]=var_value

```php
$_REQUEST['snippet'];//имя сниппета
$_REQUEST['data'];//массив, который будет передан в сниппет
```

обратите внимание на 54 строку

```php
//это список поддерживаемых сниппетов для запуска через ajax-шлюз
//добавьте в него имя вашего сниппета если понадобится
$a_config['snippets_available'] = array('feedback', 'getPublications', 'order');
```
в более ранних версиях встречаются версии данного шлюза, которые поддерживают перечисленный в $a_config список методов

* /manager/index.php - frontend админка

Для каждой точки входа, кроме ajax-шлюза, инициализируется автолоатер классов:

```php
autoloader_init();
```
Класс самого автолоадера тут /manager/includes/autoloader.php
Ф-я инициализации вместе со спском директорий определена в /manager/includes/config.inc.php

## Конфигурация

Файл config.inc.php

В файл /manager/includes/config.inc.php включена константа MODX_DEBUG - определяющая режим дебага для системы в целом

Для мультиязычной версии в файле определяются настройки контекста (домена)

*Кроме вышеописанного способа настройки контекста - существует два дополнительных, 
которые встречаются в более ранних версиях.*

* *в корне сайта файл context_config.php*
* *в поле introtext корневых документов сайта. Массив представлен в виде json*

В самом конце файла определены ф-ии для инициализации автолоалера классов и exception_handler-а

## Экземпляр modx
Классический класс DocumentParser "обернут" в класс ModExt. Что дает возможность обновить DocumentParser и систему в целом.
```php
class ModExt extennd DocumentParser{}
```
На страницах инициализации вызывается именно ModExt. В нем переопределены и отредактированы некоторые ключевые методы родителя
В последних версиях для инициализации modx используется паттерн singletone - поэтому в любой момент времени получить
экзумпляр класса можно используя след вызов:

```php
ModExt::app();
```
В соответствии с паттерном прямой доступ к конструктору закрыт и разработчик не может создать несколько копий приложения.
На текущий момент данный подход позволяет обеспечить целостность системы:

* один контейнер с настройками
* одно соединение с БД
* возможность исключить переменную $modx из глобальной области видимости

```php
//Например, в плягинах больше не нужно использовать ключевое слово global для доступа к экземпляру modx
global $modx; //replace it to $modx = ModExt::app();
```


метод app либо вернет созданный ранее екземпляр, либо создаст его если это первый вызов.

**Обратите внимание**, что метод app принимает buell-переменную $is_ajax, которая по-умолчанию равна false
и определяет нужно ли "собирать" страницу или достаточно просто инициализировать приложение:
```php
$modx = ModExt::app($is_ajax=true)); //см. /index-ajax.php
```

## Структура шаблонов

Система, в разрез идеологии разработчиков, ориентирована на работу с файлами.
Сущьность шаблона базируется на записи в таблице site_templates. В тело шаблона помещается запись вида:

@FILE assets/templates/some_dir/file.html

assets/templates/some_dir/file.html - является физическим файлом на сервере, куда и помещается привычный код шаблона

*Литерал конструкции "@FILE" унаследован от @-привязок [Modx](http://modx.ru/novosti-i-stati/article/37/) в TV-параметрах *

Шаблон может содержать вложенные ссылки на подшаблоны, которые также будут раскрыты.

**Обратите внимание** Парсингом @-привязок занимается плагин "File Source Template", который, в свою очередь,
отрабатывает на событие "OnParseDocument". Делайте выводы!

# Инструменты

## @-привязки в сниппетах

Существует три типа @-привязок для получения кода tpl-шаблона (содержащий плейсхолдеры вида [+name+]):

* @CODE:```<div>[+placeholder+]</div>```  - код
* @FILE:assets/templates/somedir/file - файл
* @TPL:assets/templates/somedir/file.tpl  - файл (@FILE - mirror)

*Данный литерал взят у классического сниппет систем modx - Wayfinder. Не забываем их использовать в файлоориентированной версии Modx*

Для получения шаблона необходимо обратится к методу ModExt::app()->getTpl()
```php
//В вызов сниппета передали:
$tpl="@CODE:<div>[+placeholder+]</div>";
//либо
$tpl="@FILE:assets/templates/somedir/file";
//либо
$tpl="chunk_name";

//начало кода сниппета
$s_tpl = isset($tpl) ? ModExt::app()->getTpl($tpl);
$s_tpl = isset($tpl) ? $modx->getTpl($tpl);//another way

```
В $tpl должна быть передана строка с @-привязкой либо имя чанка - в любом из вышеперечисленных способов мы получим содержимое шаблона


## Структура клиент скриптов
## Frontend recomendation
# Префиксивная система имен
# github
